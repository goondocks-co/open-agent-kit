# =============================================================================
# Feature Documentation Agent
# =============================================================================
#
# Specialized agent for documenting individual features.
# Creates and maintains docs/features/{feature}.md files.
#
# =============================================================================

name: feature-docs
display_name: "Feature Documentation"
agent_type: documentation
description: |
  Documents individual OAK features by combining code analysis with CI memories.
  Surfaces gotchas, explains design decisions, and keeps docs accurate.

default_task: |
  Document OAK features that are missing or outdated documentation.

  **Step 1: Discover features needing docs**
  - List directories in src/open_agent_kit/features/
  - Check which have corresponding docs/features/{name}.md files
  - Use ci_search to find recently changed features

  **Step 2: For each feature needing documentation**
  Run these CI queries:
  1. ci_search "{feature}" type=plans → Find original design intent
  2. ci_search "{feature} implementation" type=code → Find actual code
  3. ci_memories filter=gotcha "{feature}" → Find gotchas to surface as warnings
  4. ci_memories filter=decision "{feature}" → Find design decisions

  **Step 3: Write/update the feature doc**
  Create docs/features/{feature}.md with these sections:
  - ## Overview (from plans + code)
  - ## How It Works (from code search)
  - ## Configuration (from code, if applicable)
  - ## ⚠️ Gotchas (REQUIRED if any gotcha memories exist)
  - ## Design Decisions (from decision memories + plans)

  **Step 4: Verify accuracy**
  Use ci_search to verify any claims against actual code.

maintained_files:
  - path: "docs/features/*.md"
    purpose: "Individual feature documentation"
    naming: "docs/features/{feature_name}.md"
    auto_create: true

ci_queries:
  discovery:
    - tool: ci_search
      query_template: "{feature}"
      search_type: plans
      limit: 10
      purpose: "Find the original plan explaining design intent"
      required: true

    - tool: ci_search
      query_template: "{feature} implementation"
      search_type: code
      limit: 15
      purpose: "Find actual code to document accurately"
      required: true

  context:
    - tool: ci_memories
      query_template: "{feature}"
      filter: gotcha
      limit: 20
      purpose: "Find gotchas to surface as warnings"
      required: true

    - tool: ci_memories
      query_template: "{feature}"
      filter: decision
      limit: 15
      purpose: "Find design decisions to explain the 'why'"
      required: true

    - tool: ci_memories
      query_template: "{feature}"
      filter: discovery
      limit: 10
      purpose: "Find patterns to include as best practices"

  verification:
    - tool: ci_search
      query_template: "{claim}"
      search_type: code
      limit: 5
      purpose: "Verify claims against the codebase"

output_requirements:
  required_sections:
    - name: "Overview"
      source: "plans + code"
    - name: "How It Works"
      source: "code"
    - name: "⚠️ Gotchas"
      source: "memories:gotcha"
      description: "MANDATORY if any gotcha memories exist"
    - name: "Design Decisions"
      source: "memories:decision + plans"

style:
  tone: "concise"
  include_examples: true
  link_code_files: true  # When memories reference files, include links in docs
  code_link_format: "relative"  # "relative" for ./path or "line" for path:line
  conventions:
    - "Use imperative mood in headings"
    - "Include code examples with syntax highlighting"
    - "Document the 'why' not just the 'what'"
    - "Use > blockquotes for gotcha warnings"
    - "Link to source files when referencing code (e.g., [see implementation](src/path/to/file.py))"

schema_version: 1
