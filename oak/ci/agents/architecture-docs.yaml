# =============================================================================
# Architecture Documentation Agent
# =============================================================================
#
# Specialized agent for documenting architectural decisions and system design.
# Maintains docs/architecture/*.md and keeps oak/constitution.md accurate.
#
# =============================================================================

name: architecture-docs
display_name: "Architecture Documentation"
agent_type: documentation
description: |
  Documents OAK's architecture by surfacing ALL design decisions and trade-offs
  from CI memories. Keeps the constitution and architecture docs in sync with
  how the system actually works.

default_task: |
  Review and update OAK's architecture documentation.

  **Step 1: Gather all architectural context**
  Run these CI queries:
  1. ci_memories filter=decision limit=50 → Get ALL design decisions
  2. ci_memories filter=trade_off limit=30 → Get ALL trade-offs
  3. ci_search "architecture" type=plans → Find original design docs

  **Step 2: Review oak/constitution.md**
  - Check that golden paths match actual implementation
  - Verify anchor index points to correct files
  - Update any outdated conventions

  **Step 3: Update architecture docs**
  For each major component (features, agents, daemon, etc.):
  - Create/update docs/architecture/{component}.md
  - Include design decisions that affect this component
  - Document trade-offs that were made
  - Explain the "why" behind structural choices

  **Step 4: Cross-reference**
  Ensure architecture docs reference:
  - Related feature docs
  - Relevant decision memories
  - Original plans where applicable

maintained_files:
  - path: "docs/architecture/*.md"
    purpose: "Architecture documentation with design decisions"
    naming: "docs/architecture/{component}.md"
    auto_create: true

  - path: "oak/constitution.md"
    purpose: "Project constitution - update carefully"

ci_queries:
  discovery:
    - tool: ci_search
      query_template: "{component} architecture"
      search_type: plans
      limit: 10
      purpose: "Find original design documents"
      required: true

    - tool: ci_search
      query_template: "{component}"
      search_type: code
      limit: 20
      purpose: "Find implementation details"

  decisions:
    - tool: ci_memories
      filter: decision
      limit: 50
      purpose: "Find ALL architectural decisions"
      required: true

    - tool: ci_memories
      filter: trade_off
      limit: 30
      purpose: "Find trade-offs to explain design choices"
      required: true

    - tool: ci_memories
      query_template: "{component}"
      filter: gotcha
      limit: 15
      purpose: "Find architectural gotchas"

output_requirements:
  required_sections:
    - name: "Overview"
      source: "plans"
    - name: "Design Decisions"
      source: "memories:decision"
      description: "MUST include all relevant decision memories"
    - name: "Trade-offs"
      source: "memories:trade_off"
    - name: "Component Structure"
      source: "code"

style:
  tone: "technical"
  include_examples: false
  link_code_files: true
  code_link_format: "relative"
  conventions:
    - "Focus on the 'why' over the 'what'"
    - "Link to specific decision memories when available"
    - "Include diagrams where helpful (mermaid)"
    - "Reference original plans/RFCs"
    - "Link to source files when explaining structure (e.g., [registry](src/path/registry.py))"

schema_version: 1
