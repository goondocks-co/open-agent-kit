# =============================================================================
# Built-in Task: Codebase Activity Report
# =============================================================================
# Task for: analysis agent
#
# Analyzes file hotspots, tool usage patterns, memory accumulation,
# and active areas of the codebase.
# =============================================================================

name: codebase-activity-report
display_name: "Codebase Activity Report"
agent_type: analysis
is_builtin: true
description: >
  Analyzes file modification hotspots, tool usage patterns, memory
  accumulation over time, and identifies the most active areas of the codebase.

default_task: |
  Generate a codebase activity report.

  Use ci_query for all data gathering. Refer to the database schema in
  your system prompt for column names and types â€” do not assume column
  names from these instructions.

  ## 1. File Hotspot Analysis

  Use ci_query against activities to identify the most-modified files:
  - Top 20 files by write/edit count
  - Top 20 files by read count
  - Files with highest error rates
  - Group hotspots by top-level directory to identify active areas

  ## 2. Tool Usage Patterns

  Use ci_query against activities to analyze tool usage:
  - Tool usage frequency with success counts (overall)
  - Tool usage trends over time (weekly)
  - Average tools per session
  - Which tools tend to be used together in the same session

  ## 3. Memory Accumulation

  Use ci_query against memory_observations to track knowledge growth:
  - Memories by type over time (monthly)
  - Total memories by type
  - Recent memory trends (are new gotchas being discovered?)
  - Memories per session ratio

  ## 4. Memory Lifecycle

  Use ci_query against memory_observations to analyze observation lifecycle:
  - Status distribution: `SELECT status, count(*) as count FROM memory_observations GROUP BY status`
  - Active observations by session origin type: `SELECT session_origin_type, count(*) as count FROM memory_observations WHERE status='active' GROUP BY session_origin_type`
  - Resolution velocity: how quickly observations get resolved (days between creation and resolution)
  - Unresolved planning observations that may be stale

  ## 5. Active Codebase Areas

  Use ci_query to identify which parts of the codebase are most active:
  - Group file paths by top-level directory
  - Activity density (activities per unique file)
  - New vs modified files ratio

  ## 6. Write Report

  Write the report with hotspot visualizations (markdown tables),
  trend analysis, and suggestions for areas needing attention.

execution:
  timeout_seconds: 180
  max_turns: 50
  permission_mode: acceptEdits

maintained_files:
  - path: "{project_root}/oak/insights/codebase-activity-report.md"
    purpose: "Codebase activity analysis report"
    auto_create: true

ci_queries:
  discovery:
    - tool: ci_project_stats
      purpose: "Get baseline codebase metrics"

style:
  tone: "analytical"
  include_examples: false

schema_version: 1
