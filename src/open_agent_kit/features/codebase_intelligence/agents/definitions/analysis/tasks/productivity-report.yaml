# =============================================================================
# Built-in Task: Productivity Analysis
# =============================================================================
# Task for: analysis agent
#
# Analyzes session quality, activity classification, and error rates
# to identify productivity patterns and improvement opportunities.
# =============================================================================

name: productivity-report
display_name: "Productivity Analysis"
agent_type: analysis
is_builtin: true
description: >
  Analyzes session completion rates, activity classifications, error trends,
  and productive time periods to identify productivity patterns.

default_task: |
  Generate a productivity analysis report.

  Use ci_query for all data gathering. Refer to the database schema in
  your system prompt for column names and types â€” do not assume column
  names from these instructions.

  ## 1. Session Quality

  Use ci_query against sessions to analyze completion and quality:
  - Completion rate (completed vs total sessions)
  - Sessions with summaries vs without
  - Average prompt count and tool count per session
  - Sessions by quality tier (high activity vs low activity)

  ## 2. Activity Classification

  Use ci_query against prompt_batches to break down by classification:
  - Distribution of classifications (exploration, implementation, debugging, etc.)
  - Classification trends over time (weekly)
  - Which classifications correlate with longer sessions

  ## 3. Error Rate Trends

  Use ci_query against activities to analyze tool execution failures:
  - Error rate by tool name (only tools with meaningful sample size)
  - Error rate trend over time (weekly)
  - Most common error patterns (group by error message)

  ## 4. Time Patterns

  Use ci_query to identify productive time periods by extracting
  hour-of-day and day-of-week from epoch timestamps:
  - Activity volume by hour of day
  - Activity volume by day of week
  - Most productive periods

  ## 5. Write Report

  Write the report with key findings, tables, and recommendations
  for improving coding session quality.

execution:
  timeout_seconds: 180
  max_turns: 50
  permission_mode: acceptEdits

maintained_files:
  - path: "{project_root}/oak/insights/productivity-report.md"
    purpose: "Productivity analysis report"
    auto_create: true

ci_queries:
  discovery:
    - tool: ci_project_stats
      purpose: "Get baseline metrics"

style:
  tone: "analytical"
  include_examples: false

schema_version: 1
