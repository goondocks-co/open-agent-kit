{
  "$comment": "Codebase Intelligence hooks for Gemini CLI. {{PORT}} is replaced with the project-specific daemon port. OAK hooks are identified by the /api/oak/ci/ URL pattern.",
  "hooks": {
    "SessionStart": [
      {
        "matcher": "*",
        "hooks": [
          {
            "name": "oak-ci-context",
            "type": "command",
            "command": "(curl -sf http://localhost:{{PORT}}/api/health >/dev/null 2>&1 || oak ci start --quiet >/dev/null 2>&1 || true) && cat | jq -c '{agent: \"gemini\", session_id: .session_id}' | curl -s -X POST http://localhost:{{PORT}}/api/oak/ci/session-start -H 'Content-Type: application/json' -d @-",
            "timeout": 60000
          }
        ]
      }
    ],
    "AfterTool": [
      {
        "matcher": "*",
        "hooks": [
          {
            "name": "oak-ci-observe",
            "type": "command",
            "command": "cat | jq -c '{agent: \"gemini\", session_id: .session_id, tool_name: .tool_name, tool_input: .tool_input, tool_output_b64: ((.tool_response // {}) | tostring | @base64)}' | curl -s -X POST http://localhost:{{PORT}}/api/oak/ci/post-tool-use -H 'Content-Type: application/json' -d @-",
            "timeout": 15000
          }
        ]
      }
    ],
    "AfterAgent": [
      {
        "matcher": "*",
        "hooks": [
          {
            "name": "oak-ci-stop",
            "type": "command",
            "command": "cat | jq -c '{agent: \"gemini\", session_id: .session_id}' | curl -s -X POST http://localhost:{{PORT}}/api/oak/ci/stop -H 'Content-Type: application/json' -d @-",
            "timeout": 15000
          }
        ]
      }
    ],
    "SessionEnd": [
      {
        "matcher": "*",
        "hooks": [
          {
            "name": "oak-ci-session-end",
            "type": "command",
            "command": "cat | jq -c '{agent: \"gemini\", session_id: .session_id}' | curl -s -X POST http://localhost:{{PORT}}/api/oak/ci/session-end -H 'Content-Type: application/json' -d @-",
            "timeout": 15000
          }
        ]
      }
    ]
  }
}
