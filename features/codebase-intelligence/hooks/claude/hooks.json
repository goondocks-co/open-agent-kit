{
  "$schema": "https://raw.githubusercontent.com/anthropics/claude-code/main/schemas/hooks.json",
  "$comment": "Codebase Intelligence hooks for Claude Code. {{PORT}} is replaced with the project-specific daemon port. OAK hooks are identified by the /api/oak/ci/ URL pattern.",
  "hooks": {
    "SessionStart": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "(curl -sf http://localhost:{{PORT}}/api/health >/dev/null 2>&1 || oak ci start --quiet >/dev/null 2>&1 || true) && cat | jq -c '{agent: \"claude\", session_id: .session_id, source: .source}' | curl -s -X POST http://localhost:{{PORT}}/api/oak/ci/session-start -H 'Content-Type: application/json' -d @- | jq -c '{hookSpecificOutput: {hookEventName: \"SessionStart\", additionalContext: .context.injected_context}}'",
            "timeout": 30
          }
        ]
      }
    ],
    "UserPromptSubmit": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "cat | jq -c '{agent: \"claude\", session_id: .session_id, prompt: .prompt}' | curl -s -X POST http://localhost:{{PORT}}/api/oak/ci/prompt-submit -H 'Content-Type: application/json' -d @- | jq -c 'if .context.injected_context then {hookSpecificOutput: {hookEventName: \"UserPromptSubmit\", additionalContext: .context.injected_context}} else {} end'",
            "timeout": 5
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "cat | jq -c '{agent: \"claude\", session_id: .session_id, tool_name: .tool_name, tool_input: .tool_input, tool_output_b64: ((.tool_response // {}) | tostring | @base64)}' | curl -s -X POST http://localhost:{{PORT}}/api/oak/ci/post-tool-use -H 'Content-Type: application/json' -d @- | jq -c 'if .injected_context then {hookSpecificOutput: {hookEventName: \"PostToolUse\", additionalContext: .injected_context}} else {} end'",
            "timeout": 3
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "cat | jq -c '{agent: \"claude\", session_id: .session_id}' | curl -s -X POST http://localhost:{{PORT}}/api/oak/ci/stop -H 'Content-Type: application/json' -d @-",
            "timeout": 5
          }
        ]
      }
    ]
  }
}
